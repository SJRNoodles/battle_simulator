<!DOCTYPE html>
<html>
<style>
html,body{
margin:0;
width:100%;
height:100%;
}
h1 {
text-align:center;
}
#head{
background-color:gray;
}
#viewport{
width:50%;
padding:5px;
background:black;
padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
}
#game{
padding:5px;
background:black;
padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
}
button{
width:15%;
background:gray;
padding:5px;
border:none;
}
</style>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<body>
<h1 id="head">sjrnoodles' battle simulator</h1>
Welcome to the battle simulator. This is in development!
<br>
<div id="game">
<canvas id="viewport" width="180" height="120" style="border:1px solid #000000;">
</canvas>
<br>
<div id="buttons">
<button onclick="moves()">Move</button>
</div>
</div>
</body>

<script>
  // SJRNOODLES'
  // B A T T L E S I M U L A T O R
  // 2022 sjrnoodles
  
  // game vars
 function readJSON(file) {
    var request = new XMLHttpRequest();
    request.open('GET', file, false);
    request.send(null);
    if (request.status == 200)
        return request.responseText;
};

function getRandomArbitrary(min, max) {
  return Math.random() * (max - min) + min;
}

const player = JSON.parse(readJSON('https://sjrnoodles.github.io/battle_simulator/base/player.json'));
const enemy = JSON.parse(readJSON('https://sjrnoodles.github.io/battle_simulator/base/enemy.json'));
var shake = 0;
var turn = 0;

console.log(player.moves.m1.name);

function moves(){
	document.getElementById("buttons").innerHTML = '<button onclick="move1()">' + player.moves.m1.name +'</button>';
  document.getElementById("buttons").innerHTML = document.getElementById("buttons").innerHTML + '<button onclick="move2()">' + player.moves.m2.name +'</button>';
  document.getElementById("buttons").innerHTML = document.getElementById("buttons").innerHTML + '<button onclick="move3()">' + player.moves.m3.name +'</button>';
}

function moveAfter(){
	if(Math.round(Math.random() * (1 - 3) + 1) == 1){
  	player.health -= enemy.moves.m1.dmg;
  }else{
  	if(Math.round(Math.random() * (1 - 2) + 1) == 2){
  		player.health -= enemy.moves.m2.dmg;
  	}else{
  			player.health -= enemy.moves.m3.dmg;
    }
  }
  shake = 2;
  setTimeout(turn=0, 1000);
}
console.log(player.health);
function move1(){
	if (turn == 0){
  	turn = 1;
		enemy.health -= player.moves.m1.dmg;
  	shake = 2;
  	setTimeout(moveAfter, 1000);
 		console.log(enemy.health);
  }
}

function move2(){
	if (turn == 0){
  	turn = 1;
		enemy.health -= player.moves.m2.dmg;
  	shake = 2;
  	setTimeout(moveAfter, 1000);
 		console.log(enemy.health);
  }
}

function move3(){
	if (turn == 0){
  	turn = 1;
		enemy.health -= player.moves.m3.dmg;
  	shake = 2;
  	setTimeout(moveAfter, 1000);
 		console.log(enemy.health);
  }
}

var c = document.getElementById("viewport");
var b1 = (player.health / 40);
    var ctx = c.getContext("2d");

  function basic_render(){
    
    //bg
    var base_bg = new Image();
    base_bg.src = "https://sjrnoodles.github.io/battle_simulator/assets/bg_canvas.png";
    var bg = base_bg;
    ctx.drawImage(bg,0 + getRandomArbitrary(shake * -1, shake),getRandomArbitrary(shake * -1, shake));
    
    // player
    var base_plr = new Image();
    base_plr.src = String(player.sprite);
    var img = base_plr;
    ctx.drawImage(img,30,60 + getRandomArbitrary(shake * -1, shake));

    // enemy
    var base_en = new Image();
    base_en.src = "https://sjrnoodles.github.io/battle_simulator/assets/enemy_.png";
    var img2 = base_en;
    ctx.drawImage(img2,110,60 + getRandomArbitrary(shake * -1, shake));
  }
  
  function gui_render(){
  // player health
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, 75, 10);
  ctx.font = "8px Arial";
ctx.fillStyle = "white";
ctx.textAlign = "center";
ctx.fillText("Health:", 16, 8);
ctx.fillStyle = "green";
  ctx.fillRect(30, 3, player.health / b1, 5);
  
  // enemy health
  ctx.fillStyle = "black";
  ctx.fillRect(105, 0, 75, 10);
  ctx.font = "8px Arial";
ctx.fillStyle = "white";
ctx.textAlign = "center";
ctx.fillText("Health:", 120, 8);
ctx.fillStyle = "red";
  ctx.fillRect(135, 3, enemy.health / b1, 5);
  }
  
  function render(){
  shake += shake * -0.2;
  	basic_render();
    gui_render();
  }
  
 window.onload = setInterval(render,1000/30);
</script>

</html>
